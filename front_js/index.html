<!DOCTYPE html>
<html lang="fr">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link rel="stylesheet" href="css/style.css" />
        <title>HP</title>
        <link rel="icon" href="img/HP_-_Harry_Potter_wordmark.svg.png" />
    </head>
    <body>
        <nav>
            <a href="filtre_hp.html">Filtre</a>
            <a href="inscription.html">Inscription</a>
            <a href="connexion.html">Connexion</a>
            <a href="utilisateur.html">Profil</a>
        </nav>

        <header>
            <h1>Tous les personnages</h1>

            <div id="rechercheDynamique">
                <input type="text" id="searchInput" placeholder="Search..." />
                <ul id="searchResults"></ul>
            </div>

            <button id="favoriteButton" class="favorite"></button>
        </header>

        <div id="characters__index"></div>

        <div id="b">
            <button onclick="PopUp()">Test</button>
        </div>

        <div id="popUp">
            <h4>Ouiiiiiiii</h4>
            <p>ouiiiiiii</p>
            <label for="perso">Choisi une carte:</label>
            <select name="perso" id="PersoPop"></select>
            <p onclick="fermer()">Close</p>
        </div>

        <script>
            //La fonction fetch permet de récupérer tous les personnages présents dans l'api donner grâce au lien et de le rendre en .json
            function fetchPerso() {
                return fetch("https://hp-api.lainocs.fr/characters").then(
                    (response) => response.json()
                );
            }

            //async et await permet d'attendre la réponse de la fonction fetch
            //Fonction qui affiche tous les personnages présent dans la "liste" renvoyer par la fonction fetch
            async function displayCharaters() {
                const data = await fetchPerso();
                data.forEach((characters) => {
                    document.getElementById("characters__index").innerHTML += `

                    <div class="carte_characters">
                        <a href="perso_hp.html?slug=${characters.slug}">
                        <img src="${characters.image}" alt="${characters.name}" class="img_perso_index">
                        <h2 id="carte_nom">${characters.name}</h2>
                    </a>
                    </div>

                `;
                });
            }

            displayCharaters();

            function PopUp() {
                document.getElementById("popUp").style.display = "flex";
                PersoPopUp();
            }

            function fermer() {
                document.getElementById("popUp").style.display = "none";
            }

            async function PersoPopUp() {
                const data = await fetchPerso();

                data.forEach((characters) => {
                    document.getElementById("PersoPop").innerHTML += `
                    <option value="${characters.slug}">${characters.name}</option>
                `;
                });
            }

            //------------------------------------------------------------------------------------------------------------------------

            document.addEventListener("DOMContentLoaded", function () {
                const searchInput = document.getElementById("searchInput");
                const searchResults = document.getElementById("searchResults");

                searchInput.addEventListener("input", function () {
                    const searchTerm = searchInput.value.trim().toLowerCase();

                    if (searchTerm === "") {
                        searchResults.innerHTML = ""; // Clear previous results
                        return; // Exit early if search term is empty
                    }

                    // Fetch data from API
                    fetch(
                        `https://hp-api.lainocs.fr/characters?q=${searchTerm}`
                    )
                        .then((response) => response.json())
                        .then((data) => {
                            searchResults.innerHTML = ""; // Clear previous results
                            // Display matching results
                            data.forEach((character) => {
                                if (
                                    character.name
                                        .toLowerCase()
                                        .includes(searchTerm)
                                ) {
                                    const li = document.createElement("li");
                                    const a = document.createElement("a");
                                    a.textContent = character.name; // Afficher uniquement le nom
                                    a.href = `perso_hp.html?slug=${character.slug}`;
                                    li.appendChild(a);
                                    searchResults.appendChild(li);
                                }
                            });
                        })
                        .catch((error) => {
                            console.error("Error fetching data:", error);
                        });
                });
            });

            //----------------------------------------------------------------------------------------------------------------------------------------

            document.addEventListener("DOMContentLoaded", function () {
                const favoriteButton =
                    document.getElementById("favoriteButton");

                favoriteButton.addEventListener("click", function () {
                    favoriteButton.classList.toggle("clicked"); // Toggle la classe 'clicked'
                });
            });

            //----------------------------------------------------------------------------------------------------------------------------------------
        </script>
    </body>
</html>
